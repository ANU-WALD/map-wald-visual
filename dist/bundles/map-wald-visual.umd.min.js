!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@angular/core"),require("@angular/forms"),require("@ng-bootstrap/ng-bootstrap"),require("@angular/common/http"),require("ngx-pipes"),require("@agm/core"),require("@angular/common"),require("map-wald"),require("store"),require("@agm/core/services/google-maps-types"),require("plotly.js/dist/plotly-basic"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define("map-wald-visual",["@angular/core","@angular/forms","@ng-bootstrap/ng-bootstrap","@angular/common/http","ngx-pipes","@agm/core","@angular/common","map-wald","store","@agm/core/services/google-maps-types","plotly.js/dist/plotly-basic","rxjs/operators","rxjs"],t):(e=e||self)["map-wald-visual"]=t(e.ng.core,e.ng.forms,e.ngBootstrap,e.ng.common.http,e.ngxPipes,e.core$1,e.ng.common,e.mapWald,e.store,e.googleMapsTypes,e.plotlyBasic,e.rxjs.operators,e.rxjs)}(this,(function(e,t,n,o,a,i,r,l,s,p,c,d,u){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,a=a&&a.hasOwnProperty("default")?a.default:a,i=i&&i.hasOwnProperty("default")?i.default:i,r=r&&r.hasOwnProperty("default")?r.default:r,l=l&&l.hasOwnProperty("default")?l.default:l,s=s&&s.hasOwnProperty("default")?s.default:s,p=p&&p.hasOwnProperty("default")?p.default:p,c=c&&c.hasOwnProperty("default")?c.default:c,d=d&&d.hasOwnProperty("default")?d.default:d,u=u&&u.hasOwnProperty("default")?u.default:u;var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function h(e,t){return e(t={exports:{}},t.exports),t.exports}var g=h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(e,t){this._wmsService=e,this._wrapper=t,this.opacity=1,this.position=0,this.zoom=4,this.building=!1}return t.prototype.buildMap=function(){var e=this;this.building||(this.building=!0,this._wrapper.getNativeMap().then((function(t){if(e.building=!1,e.map=t,e.overlay=e._wmsService.buildImageMap((function(){return e.map}),(function(t){return e.url+"?"}),(function(t){return e.params}),(function(){return e.opacity})),e.map.overlayMapTypes.length>e.position)e.map.overlayMapTypes.removeAt(e.position),e.map.overlayMapTypes.insertAt(e.position,e.overlay);else for(;e.map.overlayMapTypes.length<=e.position;)e.map.overlayMapTypes.push(e.overlay)})).catch((function(e){return console.log(e)})))},t.prototype.ngOnInit=function(){this.url&&this.buildMap()},t.prototype.ngOnChanges=function(e){this.url&&this.buildMap()},t.prototype.ngOnDestroy=function(){var e=this;this._wrapper.getNativeMap().then((function(t){e.map.overlayMapTypes.length>e.position&&e.map.overlayMapTypes.removeAt(e.position)}))},t.ctorParameters=function(){return[{type:l.WMSService},{type:i.GoogleMapsAPIWrapper}]},o([e.Input(),a("design:type",String)],t.prototype,"url",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"params",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"opacity",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"position",void 0),t=o([e.Component({selector:"wms-layer",template:""}),a("design:paramtypes",[l.WMSService,i.GoogleMapsAPIWrapper])],t)}();n.WMSLayerComponent=r})),m=(y(g),g.WMSLayerComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(e){this._palettes=e,this.colours=["red","white","blue"],this.labels=[],this.title="the title",this.mapUnits="",this.helpText="No comment",this.tooltipPlacement="right",this.generatedLabels=[],this.formatValue=function(e,t){if(!e)return 0===e?"0":"-";var n=e.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),0===t?n[0]:(null!=t&&2===n.length&&(n[1]=n[1].substr(0,t),n[1]=n[1].replace(/0+$/,"")),n.join("."))}}return Object.defineProperty(t.prototype,"cbPalette",{get:function(){return this._cbPalette},set:function(e){this._cbPalette=e,this.generatePalette()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cbCount",{get:function(){return this._cbCount},set:function(e){this._cbCount=e,this.generatePalette()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cbReverse",{get:function(){return this._cbReverse},set:function(e){this._cbReverse=e,this.generatePalette()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cbRange",{get:function(){return this._cbRange},set:function(e){this._cbRange=e,this.generatePalette()},enumerable:!0,configurable:!0}),t.prototype.generateLabels=function(e){if(!this._cbRange||!e)return null;var t,n=(this._cbRange[1]-this._cbRange[0])/e,o=[],a=this._cbRange[0],i=Math.max(0,2-+Math.log10(this._cbRange[1]-this._cbRange[0]).toFixed());i=Math.min(i,10);for(var r=1;r<e;r++)t=this._cbRange[0]+r*n,o.push(this.formatValue(a,i)+"-"+this.formatValue(t,i)),a=t;return o.push("&ge;"+this.formatValue(t,i)),o.reverse(),o},t.prototype.generatePalette=function(){var e=this;this._cbPalette&&this._cbCount&&this._palettes.getPalette(this._cbPalette,this._cbReverse,this._cbCount).subscribe((function(t){e.colours=t.slice().reverse(),e.generatedLabels=e.labels||e.generateLabels(e.colours.length)||t}))},t.prototype.ngOnInit=function(){},t.ctorParameters=function(){return[{type:l.PaletteService}]},o([e.Input(),a("design:type",String)],t.prototype,"imageURL",void 0),o([e.Input(),a("design:type",Array)],t.prototype,"colours",void 0),o([e.Input(),a("design:type",Array)],t.prototype,"labels",void 0),o([e.Input(),a("design:type",String)],t.prototype,"title",void 0),o([e.Input(),a("design:type",String)],t.prototype,"mapUnits",void 0),o([e.Input(),a("design:type",String)],t.prototype,"helpText",void 0),o([e.Input(),a("design:type",String)],t.prototype,"tooltipPlacement",void 0),o([e.Input(),a("design:type",String)],t.prototype,"attribution",void 0),o([e.Input(),a("design:type",String)],t.prototype,"attributionLink",void 0),o([e.Input(),a("design:type",String),a("design:paramtypes",[String])],t.prototype,"cbPalette",null),o([e.Input(),a("design:type",Number),a("design:paramtypes",[Number])],t.prototype,"cbCount",null),o([e.Input(),a("design:type",Boolean),a("design:paramtypes",[Boolean])],t.prototype,"cbReverse",null),o([e.Input(),a("design:type",Array),a("design:paramtypes",[Array])],t.prototype,"cbRange",null),t=o([e.Component({selector:"map-legend",template:'<div class="map-legend panel panel-group">\n\n<strong>{{title}} <span *ngIf="mapUnits" [innerHTML]="\'(\'+mapUnits+\')\'"></span>\n        <span *ngIf="helpText"\n              [ngbTooltip]="helpText"\n              [placement]="tooltipPlacement"\n              container="body">\n          <i class="fa fa-info-circle"></i>\n        </span>\n</strong>\n\n  <div *ngIf="!imageURL">\n    <div style="display:table;line-height:15px">\n      <div style="display:table-row;padding:0;"\n          *ngFor="let colour of colours; let i=index">\n        <div class="legend-colour">\n          <i class="legend-entry" [ngStyle]="{background:colour}"></i>\n        </div>\n        <div class="legend-label">\n          <span [innerHTML]="generatedLabels[i]"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div *ngIf="imageURL">\n    <img [src]="imageURL">\n  </div>\n  <p *ngIf="attributionLink">Source: <a [href]="attributionLink">{{attribution || \'details\'}}</a></p>\n  <p *ngIf="attribution&&!attributionLink">Source: {{attribution}}</p>\n</div>\n',styles:["\n.map-legend{\n  display:block;\n  background: white;\n}\n\n.legend-colour{\n  display:table-cell;\n  padding:0px;\n}\n\n.legend-label{\n  display:table-cell;\n  padding:0px 4px 2px 2px;\n  font-size:10px;\n  vertical-align:middle;\n}\n\n.legend-entry {\n  float: left;\n  width: 15px !important;\n  height: 15px !important;\n}\n"]}),a("design:paramtypes",[l.PaletteService])],t)}();n.MapLegendComponent=i}))),b=(y(m),m.MapLegendComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(e,t){this._el=e,this._wrapper=t,this.position="TOP_RIGHT"}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){var e=this;this._wrapper.getNativeMap().then((function(t){var n=e._el.nativeElement.querySelector(".map-control-content");if("DIV"!==n.nodeName){var o=document.createElement("div");o.appendChild(n),n=o}t.controls[window.google.maps.ControlPosition[e.position]].push(n)}))},t.ctorParameters=function(){return[{type:e.ElementRef},{type:i.GoogleMapsAPIWrapper}]},o([e.ViewChild("mapControl",{static:!1}),a("design:type",e.Component)],t.prototype,"mapControl",void 0),o([e.Input(),a("design:type",String)],t.prototype,"position",void 0),t=o([e.Component({selector:"map-control",template:'<div #mapControl class="map-control-content">\n  <ng-content></ng-content>\n</div>\n',styles:[".map-control-content{\n  background: transparent;\n}\n"]}),a("design:paramtypes",[e.ElementRef,i.GoogleMapsAPIWrapper])],t)}();n.MapControlComponent=r}))),v=(y(b),b.MapControlComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.interval=2e3,this.limits=null,this.date=new Date,this.dateChange=new e.EventEmitter,this.value=0,this.label="-",this.timer=0,this.dateText="-"}return t.prototype.ngOnChanges=function(e){e.interval&&this.startTimer()},t.prototype.startTimer=function(){var e=this;this.timer&&clearInterval(this.timer),this.timer=window.setInterval((function(){return e.tick()}),this.interval)},t.prototype.ngAfterViewInit=function(){this.startTimer()},t.prototype.reset=function(){this.value=0,this.sliderMoved()},t.prototype.tick=function(){if(this.value){var e=this.value<0?-1:1;switch(this.date=new Date(this.date.getTime()),Math.abs(this.value)){case 1:this.date.setDate(this.date.getDate()+e);break;case 2:this.date.setDate(this.date.getDate()+7*e);break;case 3:this.date.setMonth(this.date.getMonth()+e);break;case 4:this.date.setFullYear(this.date.getFullYear()+e)}this.limits&&this.limits.length&&(this.date.getTime()<this.limits[0].getTime()&&(this.date=this.limits[0]),this.date.getTime()>this.limits[1].getTime()&&(this.date=this.limits[1])),this.setDateText(),this.dateChange.emit(this.date)}},t.prototype.setDateText=function(){this.dateText=this.date.toLocaleDateString()},t.prototype.sliderMoved=function(){this.setLabel()},t.prototype.setLabel=function(){switch(this.value<0?this.label="back 1":this.value>0?this.label="advance 1":this.label="-",Math.abs(this.value)){case 1:this.label+="day";break;case 2:this.label+="week";break;case 3:this.label+="month";break;case 4:this.label+="year"}},o([e.Input(),a("design:type",Object)],t.prototype,"interval",void 0),o([e.Input(),a("design:type",Array)],t.prototype,"limits",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"date",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"dateChange",void 0),t=o([e.Component({selector:"date-shifter",template:'<div>\n  <h3>{{dateText}}</h3>\n  <input type="range"\n         class="form-control"\n         min="-4"\n         [max]="4"\n         step="1"\n         [(ngModel)]="value"\n         (ngModelChange)="sliderMoved()"\n         (mouseup)="reset()">\n  <h4>{{label}}</h4>\n</div>\n\n  ',styles:[""]}),a("design:paramtypes",[])],t)}();n.DateShifterComponent=i}))),C=(y(v),v.DateShifterComponent,h((function(t,o){var a=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},i=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(e){this.modalService=e,this.label="About",this.hideMessage="Understood, I don’t need to see this again"}return t.prototype.storageKey=function(){return this.application?this.application+"-splash-skip":null},t.prototype.ngAfterViewInit=function(){var e=this;setTimeout((function(){var t=e.storageKey();t&&(e.doNotShow=s.get(t,!1)),e.doNotShow||e.show()}))},t.prototype.show=function(){this.current=this.modalService.open(this.splashTemplate,{size:"lg",windowClass:this.klass})},t.prototype.close=function(){this.current&&(this.current.close(),this.current=null)},t.prototype.doNotShowClicked=function(){var e=this.storageKey();e&&s.set(e,this.doNotShow)},t.ctorParameters=function(){return[{type:n.NgbModal}]},a([e.ViewChild("splashTemplate",{static:!1}),i("design:type",Object)],t.prototype,"splashTemplate",void 0),a([e.Input(),i("design:type",String)],t.prototype,"application",void 0),a([e.Input(),i("design:type",Object)],t.prototype,"label",void 0),a([e.Input(),i("design:type",Object)],t.prototype,"hideMessage",void 0),a([e.Input(),i("design:type",String)],t.prototype,"klass",void 0),t=a([e.Component({selector:"one-time-splash",template:'<ng-template #splashTemplate let-c="close" let-d="dismiss">\n  <div class="modal-header">\n    <h4 class="modal-title">\n      {{label}}</h4>\n    <button type="button" class="close" aria-label="Close" (click)="d(\'Cross click\')">\n      <span aria-hidden="true">&times;</span>\n    </button>\n  </div>\n  <div class="modal-body">\n    <ng-content></ng-content>\n  </div>\n  <div class="modal-footer">\n    <label *ngIf="application">\n      <input type="checkbox" [(ngModel)]="doNotShow" (ngModelChange)="doNotShowClicked()">\n      &nbsp; {{hideMessage}}\n    </label>\n    <button type="button" class="btn btn-secondary" (click)="c(\'Close click\')">Close</button>\n  </div>\n  </ng-template>\n',styles:[""]}),i("design:paramtypes",[n.NgbModal])],t)}();o.OneTimeSplashComponent=r}))),O=(y(C),C.OneTimeSplashComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.step=1,this.changed=new e.EventEmitter}return t.prototype.ngAfterViewInit=function(){},t.prototype.move=function(e){this.src[this.property]+=e,this.changed.emit(this.src)},o([e.Input(),a("design:type",String)],t.prototype,"label",void 0),o([e.Input(),a("design:type",String)],t.prototype,"property",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"src",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"step",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"changed",void 0),t=o([e.Component({selector:"date-element",template:'<div class="row no-gutters">\n  <div class="col-4">{{label}}</div>\n  <div class="col-2">\n    <button class="btn btn-secondary btn-sm" (click)="move(-step)">\n      <i class="fa fa-angle-left"></i>\n    </button>\n  </div>\n  <div class="col-4"><button class="btn btn-link btn-sm">{{src[property]}}</button></div>\n  <div class="col-2">\n    <button class="btn btn-secondary btn-sm" (click)="move(step)">\n      <i class="fa fa-angle-right"></i>\n    </button>\n  </div>\n</div>\n'}),a("design:paramtypes",[])],t)}();n.DateElementComponent=i}))),_=(y(O),O.DateElementComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.ngAfterViewInit=function(){},t=o([e.Component({selector:"share-view",template:'<button class="btn btn-secondary btn-sm"\n        ngbTooltip="Share current view"\n        placement="right"\n        [disabled]="true"\n><i class="fa fa-share-alt"></i></button>\n'}),a("design:paramtypes",[])],t)}();n.ShareViewComponent=i}))),I=(y(_),_.ShareViewComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.ngAfterViewInit=function(){},t=o([e.Component({selector:"location-search",template:'<button class="btn btn-secondary btn-sm"\n        ngbTooltip="Location search"\n        placement="right"\n        [disabled]="true"\n\n><i class="fa fa-search"></i></button>\n'}),a("design:paramtypes",[])],t)}();n.LocationSearchComponent=i}))),w=(y(I),I.LocationSearchComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,n,o){this._zone=t,this.staticData=n,this.metadata=o,this.layers=[],this.markers=[],this.mapTypeId="roadmap",this.layersChange=new e.EventEmitter,this.featureSelected=new e.EventEmitter,this.pointSelected=new e.EventEmitter,this.mapTypePosition=p.ControlPosition.BOTTOM_LEFT,this.streetViewControl=!0,this.selectedFeature=null,this.zoom=4,this.showMapType=!0,this.mapTypeOptions={position:p.ControlPosition.BOTTOM_LEFT},this.lat=-22.673858,this.lng=129.815982}return t.prototype.ngOnChanges=function(e){var t=this;e.mapTypePosition&&(null===this.mapTypePosition&&(this.showMapType=!1),this.mapTypeOptions={position:this.mapTypePosition}),e.layers&&this.setLayerPositions(),e.markers&&this.markers&&(this.infoWindows&&this.infoWindows.forEach((function(e,n){t._zone.runOutsideAngular((function(){return e.close()}))})),setTimeout((function(){t.infoWindows.forEach((function(e,n){t.markers[n].open?t._zone.runOutsideAngular((function(){return e.open()})):t._zone.runOutsideAngular((function(){return e.close()}))}))}))),e.bounds&&setTimeout((function(){return t._bounds=t.bounds}))},t.prototype.ngAfterViewInit=function(){},t.prototype.layersChanged=function(e){},t.prototype.layerAdded=function(e){var t=this;if(!this.layers.find((function(t){return t.layer===e.layer}))){var n=new l.MappedLayer;n.layer=e.layer,n.layerType="wms",n.options.legend=!0,e.layer.options.vectors?this.staticData.get(e.layer.options.host,e.layer.options.filepath).subscribe((function(o){n.staticData=o,t.activateLayer(n,e)})):this.activateLayer(n,e)}},t.prototype.activateLayer=function(e,t){e.update(),"replace"===t.action&&(t.filter?this.layers=this.layers.filter((function(e){return!t.filter(e)})):this.layers=[]),this.layers=[e].concat(this.layers),this.setLayerPositions(),this.layersChange.emit(this.layers)},t.prototype.setLayerPositions=function(){for(var e=0,t=this.layers.length-1;t>=0;t--)"wms"===this.layers[t].layerType&&(this.layers[t].options.position=e,e++)},t.prototype.extractFeature=function(e){var t=e.getGeometry();t={type:"Point",coordinates:t.get(0)};var n={};return e.forEachProperty((function(e,t){return n[t]=e})),{type:"Feature",geometry:t,properties:n}},t.prototype.clicked=function(e){var t=this.extractFeature(e.feature);this.selectedFeature=t,this.featureSelected.emit({feature:t})},t.prototype.circleClicked=function(e,t){this.selectedFeature=t,this.featureSelected.emit({feature:t,layer:e})},t.prototype.mapClick=function(e){var t=e.coords;this.pointSelected.emit(t)},t.prototype.zoomToBounds=function(e){this._bounds=e},t.prototype.zoomChanged=function(){this.layers=this.layers.slice()},t.ctorParameters=function(){return[{type:e.NgZone},{type:l.StaticDataService},{type:l.MetadataService}]},o([e.Input(),a("design:type",Array)],t.prototype,"layers",void 0),o([e.Input(),a("design:type",Array)],t.prototype,"markers",void 0),o([e.Input(),a("design:type",String)],t.prototype,"mapTypeId",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"layersChange",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"featureSelected",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"pointSelected",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"mapTypePosition",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"streetViewControl",void 0),o([e.ViewChild(i.AgmMap,{static:!1}),a("design:type",i.AgmMap)],t.prototype,"theMap",void 0),o([e.ViewChildren("infoWindows"),a("design:type",e.QueryList)],t.prototype,"infoWindows",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"zoom",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"showMapType",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"lat",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"lng",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"bounds",void 0),t=o([e.Component({selector:"layered-map",template:'<agm-map #theMap\n[(latitude)]="lat"\n[(longitude)]="lng"\n[(zoom)]="zoom"\n(zoomChange)="zoomChanged()"\n[disableDefaultUI]="false"\n[zoomControl]="false"\n[mapTypeId]="mapTypeId"\n[mapTypeControl]="showMapType"\n[mapTypeControlOptions]="mapTypeOptions"\n[streetViewControl]="streetViewControl"\nscaleControl="true"\n[fitBounds]="_bounds"\n(mapClick)="mapClick($event)">\n\n<agm-marker *ngFor="let marker of markers"\n            [longitude]="marker.loc.lng"\n            [latitude]="marker.loc.lat"\n            [iconUrl]="marker.iconUrl">\n  <agm-info-window #infoWindows [disableAutoPan]="true">\n    <strong>{{marker.value}}</strong>\n  </agm-info-window>\n</agm-marker>\n\n<ng-container *ngFor="let mp of layers.slice()|reverse; let i = index" [ngSwitch]="mp.layerType">\n  <wms-layer *ngSwitchCase="\'wms\'"\n    [url]="mp.url"\n    [params]="mp.wmsParameters"\n    [opacity]="mp.opacity"\n    [position]="mp.options.position">\n  </wms-layer>\n  <agm-data-layer *ngSwitchCase="\'vector\'"\n                [geoJson]="mp.staticData"\n                [style]="mp._styleFunc"\n                (layerClick)="clicked($event)"\n\n                >\n  </agm-data-layer>\n\n  <ng-container *ngSwitchCase="\'circle\'">\n    <agm-circle *ngFor="let f of mp.staticData.features; let j=index"\n                [latitude]="f.geometry.coordinates[1]"\n                [longitude]="f.geometry.coordinates[0]"\n                [radius]="10000000/(zoom*zoom*zoom*zoom)"\n                [fillColor]="mp.flattenedSettings?.styles?.fillColor||\'black\'"\n                [fillOpacity]="mp.flattenedSettings?.styles?.fillOpacity||1"\n                [strokeColor]="mp.flattenedSettings?.styles?.strokeColor||\'black\'"\n                [strokeOpacity]="mp.flattenedSettings?.styles?.strokeOpacity||1"\n                [strokePosition]="0"\n                [strokeWeight]="(f===selectedFeature)?3:(mp.flattenedSettings?.styles?.strokeWeight||0.5)"\n                (circleClick)="circleClicked(mp,f)"\n                >\n    </agm-circle>\n  </ng-container>\n\n  \x3c!--\n  --\x3e\n</ng-container>\n\n\x3c!-- for map controls --\x3e\n<map-control position="TOP_CENTER">\n    <ng-content select=".map-control.top-center"></ng-content>\n</map-control>\n\n<map-control position="TOP_LEFT">\n    <ng-content select=".map-control.top-left"></ng-content>\n</map-control>\n\n<map-control position="TOP_RIGHT">\n    <ng-content select=".map-control.top-right"></ng-content>\n</map-control>\n\n<map-control position="LEFT_TOP">\n    <ng-content select=".map-control.left-top"></ng-content>\n</map-control>\n\n<map-control position="RIGHT_TOP">\n    <ng-content select=".map-control.right-top"></ng-content>\n</map-control>\n\n<map-control position="LEFT_CENTER">\n    <ng-content select=".map-control.left-center"></ng-content>\n</map-control>\n\n<map-control position="RIGHT_CENTER">\n    <ng-content select=".map-control.right-center"></ng-content>\n</map-control>\n\n<map-control position="LEFT_BOTTOM">\n    <ng-content select=".map-control.left-bottom"></ng-content>\n</map-control>\n\n<map-control position="RIGHT_BOTTOM">\n    <ng-content select=".map-control.right-bottom"></ng-content>\n</map-control>\n\n<map-control position="BOTTOM_CENTER">\n    <ng-content select=".map-control.bottom-center"></ng-content>\n</map-control>\n\n<map-control position="BOTTOM_LEFT">\n    <ng-content select=".map-control.bottom-left"></ng-content>\n</map-control>\n\n<map-control position="BOTTOM_RIGHT">\n    <ng-content select=".map-control.bottom-right"></ng-content>\n</map-control>\n\n</agm-map>\n\n'}),a("design:paramtypes",[e.NgZone,l.StaticDataService,l.MetadataService])],t)}();n.LayeredMapComponent=r}))),R=(y(w),w.LayeredMapComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.ngAfterViewInit=function(){},t.prototype.zoomToLayer=function(){var e=this;this.layer.layer.spatialExtent?(console.log("Zoom to layer"),this.layer.layer.spatialExtent.subscribe((function(t){e.map.zoomToBounds(Object.assign({},t))}))):(console.log("Zoom full"),this.map.zoomToBounds(Object.assign({},this.fullBounds)))},o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Input(),a("design:type",l.MappedLayer)],t.prototype,"layer",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"fullBounds",void 0),t=o([e.Component({selector:"zoom-layer",template:'<button type="button" [disabled]="!layer" class="btn btn-secondary btn-sm"\n        ngbTooltip="Zoom to selected layer"\n        placement="right"\n        (click)="zoomToLayer()"\n><i class="fa fa-compress"></i>\n</button>\n'}),a("design:paramtypes",[])],t)}();n.ZoomLayerComponent=i}))),j=(y(R),R.ZoomLayerComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.ngAfterViewInit=function(){},t.prototype.zoomToBounds=function(){this.map.zoomToBounds(Object.assign({},this.bounds))},o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"bounds",void 0),t=o([e.Component({selector:"zoom-full",template:'<button class="btn btn-secondary btn-sm"\n        ngbTooltip="Zoom to full extent"\n        placement="right"\n        (click)="zoomToBounds()"\n><i class="fa fa-arrows-alt"></i></button>\n'}),a("design:paramtypes",[])],t)}();n.ZoomFullComponent=i}))),S=(y(j),j.ZoomFullComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.minZoom=1}return t.prototype.ngAfterViewInit=function(){},t.prototype.zoomOut=function(){this.map&&(this.map.zoom=Math.max(this.minZoom,this.map.zoom-1))},o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"minZoom",void 0),t=o([e.Component({selector:"zoom-out",template:'<button class="btn btn-secondary btn-sm"\n        ngbTooltip="Zoom out"\n        placement="right"\n        (click)="zoomOut()"\n><i class="fa fa-minus"></i></button>'}),a("design:paramtypes",[])],t)}();n.ZoomOutComponent=i}))),T=(y(S),S.ZoomOutComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.maxZoom=32}return t.prototype.ngAfterViewInit=function(){},t.prototype.zoomIn=function(){this.map&&(this.map.zoom=Math.min(this.maxZoom,this.map.zoom+1))},o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"maxZoom",void 0),t=o([e.Component({selector:"zoom-in",template:'<button class="btn btn-secondary btn-sm"\n        ngbTooltip="Zoom in"\n        placement="right"\n        (click)="zoomIn()"\n><i class="fa fa-plus"></i></button>'}),a("design:paramtypes",[])],t)}();n.ZoomInComponent=i}))),P=(y(T),T.ZoomInComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.maxZoom=32,this.baseLayers=[{map_type_id:"roadmap",label:"Road Map"},{map_type_id:"satellite",label:"Satellite"}],this.tooltip="Toggle base layer"}return t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(e){this.baseLayers&&!this.baseLayer&&(this.baseLayer=this.baseLayers[0])},t.prototype.toggleBaseLayer=function(){var e=this;if(this.map){var t=(this.baseLayers.findIndex((function(t){return t.map_type_id===e.baseLayer.map_type_id}))+1)%this.baseLayers.length;this.baseLayer=this.baseLayers[t],this.map.mapTypeId=this.baseLayer?this.baseLayer.map_type_id:null}},o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"maxZoom",void 0),o([e.Input(),a("design:type",Array)],t.prototype,"baseLayers",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"baseLayer",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"tooltip",void 0),t=o([e.Component({selector:"cycle-base-map",template:'<button class="btn btn-secondary btn-sm" (click)="toggleBaseLayer()" [ngbTooltip]="tooltip"\n                     placement="right">\n  <i class="fa" [ngClass]="baseLayer?.label===\'Road Map\'?\'fa-road\':\'fa-globe\'"></i>\n</button>'}),a("design:paramtypes",[])],t)}();n.CycleBaseMapComponent=i}))),M=(y(P),P.CycleBaseMapComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.maxZoom=32,this.tooltip="Adjust transparency of grid layer",this.layerOpacity=1,this.step=.4}return t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(e){var t=this;this.map&&this.map.layersChange.subscribe((function(){return t.updateLayers()}))},t.prototype.cycleTransparency=function(){this.layerOpacity-=this.step,this.layerOpacity<0&&(this.layerOpacity=1),this.updateLayers()},t.prototype.updateLayers=function(){var e=this;this.map.layers.forEach((function(t){return t.opacity=e.layerOpacity}))},o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"maxZoom",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"tooltip",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"layerOpacity",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"step",void 0),t=o([e.Component({selector:"cycle-opacity",template:'<button class="btn btn-secondary btn-sm"\n                     (click)="cycleTransparency()"\n                     [ngbTooltip]="tooltip"\n                     placement="right">\n<i class="fa" [ngClass]="(layerOpacity<0.5)?\'fa-circle-o\':((layerOpacity<0.9)?\'fa-adjust\':\'fa-circle\')"></i>\n</button>'}),a("design:paramtypes",[])],t)}();n.CycleOpacityComponent=i}))),x=(y(M),M.CycleOpacityComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.ngAfterViewInit=function(){},t=o([e.Component({selector:"button-bar",template:'<div class="button-bar bb-vertical">\n  <ng-content></ng-content>\n</div>\n\n',styles:["\n"]}),a("design:paramtypes",[])],t)}();n.ButtonBarComponent=i}))),L=(y(x),x.ButtonBarComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(e){this._element=e,this.timeSeries=[],this.marginLeft=40,this.marginRight=10,this.marginTop=0,this.marginBottom=20,this.titlefont=void 0}return t.prototype.ngAfterViewInit=function(){this.draw()},t.prototype.ngOnChanges=function(e){this.draw()},t.prototype.draw=function(){var e=this._element.nativeElement.querySelector(".our-chart");if(c.purge(e),this.timeSeries&&this.timeSeries.length){var t,n=this.timeSeries.map((function(e){return e.units}));n.every((function(e){return e===n[0]}))&&(t=n[0]);var o={margin:{t:this.marginTop+(this.title?30:0),l:this.marginLeft,r:this.marginRight,b:this.marginBottom},yaxis:{fixedrange:!0,title:t},width:320,height:200,title:this.title||void 0,titlefont:this.titlefont};c.plot(e,this.timeSeries.map((function(e){var n=e.values.filter((function(e){return!isNaN(e)})).length,o="bar"!==e.style&&n<365?"lines+markers":void 0,a=t?"":" ("+e.units+")";return{type:"bar"===e.style?"bar":void 0,mode:o,x:e.dates,y:e.values,name:e.label+a}})),o)}},t.ctorParameters=function(){return[{type:e.ElementRef}]},o([e.Input(),a("design:type",String)],t.prototype,"title",void 0),o([e.Input(),a("design:type",Array)],t.prototype,"timeSeries",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"marginLeft",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"marginRight",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"marginTop",void 0),o([e.Input(),a("design:type",Number)],t.prototype,"marginBottom",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"titlefont",void 0),t=o([e.Component({selector:"timeseries-chart",template:'<div class="our-chart">\n</div>\n'}),a("design:paramtypes",[e.ElementRef])],t)}();n.TimeseriesChartComponent=i}))),k=(y(L),L.TimeseriesChartComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.styles={},this._keys=Object.keys}return t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(e){this.styles||(this.styles={})},o([e.Input(),a("design:type",Object)],t.prototype,"feature",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"styles",void 0),t=o([e.Component({selector:"feature-table",template:'<table *ngIf="feature" class="table table-striped table-sm feature-table">\n  <thead>\n    <tr>\n      <td><strong>Property</strong></td>\n      <td><strong>Value</strong></td>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><strong>Geometry</strong></td>\n      <td>{{feature.geometry.type}}</td>\n    </tr>\n    <tr *ngFor="let prop of _keys(feature.properties)">\n      <td><strong>{{prop}}</strong></td>\n      <td *ngIf="!styles||!styles[prop]">{{feature.properties[prop]}}</td>\n      <td *ngIf="styles&&styles[prop]">\n        <a *ngIf="styles[prop].hyperlink" target="_blank" [href]="feature.properties[prop]">\n          {{feature.properties[prop]}}\n        </a>\n      </td>\n    </tr>\n  </tbody>\n</table>',styles:[".feature-table{\n  max-width:300px;\n}"]}),a("design:paramtypes",[])],t)}();n.FeatureTableComponent=i}))),D=(y(k),k.FeatureTableComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.ngAfterViewInit=function(){},o([e.Input(),a("design:type",Boolean)],t.prototype,"isCollapsed",void 0),o([e.Input(),a("design:type",String)],t.prototype,"heading",void 0),o([e.Input(),a("design:type",String)],t.prototype,"direction",void 0),t=o([e.Component({selector:"collapsible-map-control",template:'<div class="card map-control collapsible-control">\n    <a (click)="isCollapsed = !isCollapsed">\n      <div class="card-header">\n        <h6 class="mb-0">\n          {{heading}}\n          <span *ngIf="isCollapsed" class="float-right fa fa-caret-up\n            collapse-arrow" aria-hidden="true"></span>\n          <span *ngIf="!isCollapsed" class="float-right fa fa-caret-down\n            collapse-arrow" aria-hidden="true"></span>\n        </h6>\n      </div>\n    </a>\n\n    <div class="ngbCollapse" [ngbCollapse]="isCollapsed">\n      <ng-content></ng-content>\n    </div>\n  </div>\n',styles:[".collapsible-control{\n  margin:3px;\n}"]}),a("design:paramtypes",[])],t)}();n.CollapsibleMapControlComponent=i}))),V=(y(D),D.CollapsibleMapControlComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.ngAfterViewInit=function(){},t=o([e.Component({selector:"base-map-selection",template:"<p>base-map-selection Component</p>"}),a("design:paramtypes",[])],t)}();n.BaseMapSelectionComponent=i}))),E=(y(V),V.BaseMapSelectionComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.options={},this.nodeSelected=new e.EventEmitter}return t.prototype.ngOnChanges=function(e){this.evalState()},t.prototype.ngAfterViewInit=function(){},t.prototype.treeClick=function(e){e.stopPropagation(),e.preventDefault(),this.tree&&(this.tree.expanded=!this.tree.expanded,this.evalState(),this.tree.actions&&this.tree.actions.length?this.tree.actions[0].action(this.tree):this.nodeSelected.emit(this.tree))},t.prototype.evalState=function(){this.expanded=this.tree&&this.tree.expanded&&this.tree.children&&this.tree.children.length>0,this.leaf=this.tree&&(!this.tree.children||0===this.tree.children.length),this.collapsed=this.tree&&!this.tree.expanded&&this.tree.children&&this.tree.children.length>0,this.expanded?this.icon=this.options.expandedIcon:this.collapsed?this.icon=this.options.collapsedIcon:this.icon=this.options.leafIcon},o([e.Input(),a("design:type",Object)],t.prototype,"tree",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"options",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"nodeSelected",void 0),t=o([e.Component({selector:"simple-tree-node",template:'<a href="#"\n                (click)="treeClick($event)"\n                [ngClass]="tree.klass"><i [ngClass]="icon"></i>\n  &nbsp;\n  <span ngbTooltip="{{tree.tooltip | async}}"\n        placement="right"\n        container="body">{{tree.label}}</span>\n  <span *ngIf="tree.actions"\n        class="float-right">\n      &nbsp;\n      <i *ngFor="let a of tree.actions"\n       [ngClass]="a.icon"\n       ngbTooltip="{{a.tooltip | async}}"\n       placement="right"\n       container="body"\n       (click)="a.action(tree)">&nbsp;</i>\n  </span>\n</a>\n'})],t)}();n.SimpleTreeNodeComponent=i}))),A=(y(E),E.SimpleTreeNodeComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.showTop=!0,this.collapsedIcon="fa fa-caret-right",this.expandedIcon="fa fa-caret-down",this.leafIcon="fa fa-minus",this.nodeSelected=new e.EventEmitter,this.options={}}return t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(e){e.options||(this.options={collapsedIcon:this.collapsedIcon,expandedIcon:this.expandedIcon,leafIcon:this.leafIcon})},t.prototype.childSelected=function(e){this.nodeSelected.emit(e)},o([e.Input(),a("design:type",Object)],t.prototype,"tree",void 0),o([e.Input(),a("design:type",Boolean)],t.prototype,"showTop",void 0),o([e.Input(),a("design:type",Boolean)],t.prototype,"inner",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"collapsedIcon",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"expandedIcon",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"leafIcon",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"nodeSelected",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"options",void 0),t=o([e.Component({selector:"simple-tree",template:'<div *ngIf="tree&&tree.visible" class="simple-tree">\n\n  <div *ngIf="inner">\n    <li ><simple-tree-node [tree]="tree"\n                           [options]="options"\n                           (nodeSelected)="childSelected($event)"></simple-tree-node>\n      <ul *ngIf="tree.children&&tree.expanded" class="inner-list">\n        <simple-tree *ngFor="let t of tree.children" [tree]="t" [inner]="true"\n                    (nodeSelected)="childSelected($event)"\n                    [options]="options"></simple-tree>\n      </ul>\n    </li>\n  </div>\n\n  <div *ngIf="!inner&&showTop">\n    <ul class="outer-list">\n      <li><simple-tree-node [tree]="tree" [options]="options"\n        (nodeSelected)="childSelected($event)"></simple-tree-node>\n        <ul *ngIf="tree.children&&tree.expanded" class="inner-list">\n            <simple-tree *ngFor="let t of tree.children" [tree]="t" [inner]="true"\n            (nodeSelected)="childSelected($event)"\n            [options]="options"></simple-tree>\n        </ul>\n      </li>\n    </ul>\n  </div>\n\n  <div *ngIf="!inner&&!showTop">\n      <ul *ngIf="tree.children&&tree.expanded" class="outer-list">\n          <simple-tree *ngFor="let t of tree.children" [tree]="t" [inner]="true"\n          (nodeSelected)="childSelected($event)"\n          [options]="options"></simple-tree>\n      </ul>\n    </div>\n\n</div>\n',styles:["\n.simple-tree ul{\n  list-style-type: none\n}\n\nul.outer-list{\n  padding-left:5px;\n}\n\nul.inner-list{\n  padding-left:15px;\n}"]}),a("design:paramtypes",[])],t)}();n.SimpleTreeComponent=i}))),F=(y(A),A.SimpleTreeComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=f&&f.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},r=f&&f.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,a,i=n.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)r.push(o.value)}catch(e){a={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return r};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,n){this.metadata=n,this.showPlaceholders=!0,this.defaultAction="add",this.layerActions=[],this.layerSelected=new e.EventEmitter,this.collapsedIcon="fa fa-caret-right",this.expandedIcon="fa fa-caret-down",this.leafIcon="fa fa-minus",this.layers=[],this.tree={label:"no catalog loaded"},this.filterText="",this.filterService=t}return t.prototype.ngAfterViewInit=function(){this.catalog&&this.buildTree()},t.prototype.ngOnChanges=function(e){e.catalog&&this.catalog&&(this.filterText="",this.buildTree(),this.highlightLayers([],this.tree))},t.prototype.buildTree=function(){var e=this,t=this;this.layers=[];var n=this.catalog,o={label:n.name,expanded:!0,visible:!0},a=n.themes.map((function(e){return e.layers.filter((function(e){return e.path&&!e.skip}))})).reduce((function(e,t){return e.concat(t)}),[]),s=n.themes.filter((function(e){return e.path&&!e.skip})),p=this.layerActions.map((function(t){return{icon:t.icon,tooltip:t.tooltip,action:function(n){return e.layerClick(n.data,t.action)}}})),c=function(t){var n={label:t.name,data:t,visible:!0,actions:p},o=new l.MappedLayer;return o.layer=t,o.update(),t.description?n.tooltip=u.of(t.description):n.tooltip=e.metadata.getMetadata(o).pipe(d.map((function(e){return e[t.descriptionField||"long_name"]}))),n};function f(e){return{label:e.name,expanded:!1,visible:!0,children:e.layers.filter((function(e){return!e.path&&!e.skip})).filter((function(e){return t.showPlaceholders||!e.placeholder})).map(c)}}function y(e){var t,n,a,r,l=e.split("/"),s=o,p=-1;try{for(var c=i(l),d=c.next();!d.done;d=c.next()){var u=d.value,f=u.split("@");u=f[0],p=-1,f.length>1&&(p=+f[1]);var y=!1;try{for(var g=(a=void 0,i(s.children)),m=g.next();!m.done;m=g.next()){var b=m.value;if(b.label===u){s=b,y=!0;break}}}catch(e){a={error:e}}finally{try{m&&!m.done&&(r=g.return)&&r.call(g)}finally{if(a)throw a.error}}if(!y){var v={label:u,expanded:!1,visible:!0,children:[]};h(s,v,p),s=v}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return[s,p]}function h(e,t,n){n<0?e.children.push(t):e.children.splice(n,0,t)}o.children=n.themes.filter((function(e){return!e.path&&!e.skip})).map(f),s.forEach((function(e){var t=r(y(e.path),2),n=t[0],o=t[1];h(n,f(e),o)})),a.forEach((function(e){var t=r(y(e.path),2),n=t[0],o=t[1];h(n,c(e),o)})),this.tree=o},t.prototype.layerClick=function(e,t){var n={layer:e,action:t};this.layerSelected.emit(n)},t.prototype.nodeSelected=function(e){if(e.data){var t=e.data;this.layerClick(t,this.defaultAction)}},t.prototype.activeLayers=function(e){this.highlightLayers(e,this.tree)},t.prototype.highlightLayers=function(e,t){if(t.klass=null,t.data&&e.indexOf(t.data)>=0)return t.klass="active-layer",!0;if(t.children){for(var n=!1,o=0;o<t.children.length;o++)n=this.highlightLayers(e,t.children[o])||n;return n&&(t.klass="active-child"),t.klass=(t.klass||"")+" theme",n}return!1},t.ctorParameters=function(){return[{type:l.TreeFilterService},{type:l.MetadataService}]},o([e.Input(),a("design:type",l.Catalog)],t.prototype,"catalog",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"showPlaceholders",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"defaultAction",void 0),o([e.Input(),a("design:type",Array)],t.prototype,"layerActions",void 0),o([e.Output(),a("design:type",e.EventEmitter)],t.prototype,"layerSelected",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"collapsedIcon",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"expandedIcon",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"leafIcon",void 0),t=o([e.Component({selector:"catalog",template:'<div class="input-group">\n  <span class="input-group-btn">\n            <button class="btn" type="button" [disabled]="!filterText"\n              (click)="filterText = \'\'">\n            <i *ngIf="filterText"class="fa fa-times" aria-hidden="true"></i>\n            <i *ngIf="!filterText"class="fa fa-search" aria-hidden="true"></i>\n            </button>\n  </span>\n  <input #filterInput type="text" class="form-control" placeholder="Catalog search..."\n  [(ngModel)]="filterText"/>\n</div>\n\n<simple-tree\n  [tree]="this.filterService.filterTree(tree, filterText)"\n  [showTop]="false"\n  [leafIcon]="leafIcon"\n  [collapsedIcon]="collapsedIcon"\n  [expandedIcon]="expandedIcon"\n  (nodeSelected)="nodeSelected($event)">\n</simple-tree>\n',styles:["\n.node-name{\n  font-size:1em;\n}\n"]}),a("design:paramtypes",[l.TreeFilterService,l.MetadataService])],t)}();n.CatalogComponent=s}))),N=(y(F),F.CatalogComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t){this.timeUtils=t,this.dateChange=new e.EventEmitter,this.style="arrows",this.stepDays=1,this.referenceDate=null,this.need={day:!0,month:!0,year:!0},this.atMax=!1,this.atMin=!1}return t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(e){e.minDate&&(this.minDateStruct=this.timeUtils.convertDate(this.minDate)),e.maxDate&&(this.maxDateStruct=this.timeUtils.convertDate(this.maxDate)),e.date&&(this.dateStruct=this.timeUtils.convertDate(this.date)),e.timestep&&this.assessDateComponents(),this.checkLimits()},t.prototype.dateStructChanged=function(){this.date=new Date(Date.UTC(this.dateStruct.year,this.dateStruct.month-1,this.dateStruct.day)),this.checkReference(),this.dateChange.emit(this.date)},t.prototype.assessDateComponents=function(){this.need.day=this.need.month=this.need.year=!0,"daily"!==this.timestep&&(this.need.day=!1,"annual"===this.timestep&&(this.need.month=!1))},t.prototype.move=function(e){this.date=new Date(this.date&&this.date.getTime()),this.date.setDate(this.date.getDate()+e),this.onDateChanged(),this.dateChange.emit(this.date)},t.prototype.onDateChanged=function(){this.checkLimits()},t.prototype.checkLimits=function(){this.atMax=this.timeUtils.datesEqual(this.dateStruct,this.maxDateStruct),this.atMin=this.timeUtils.datesEqual(this.dateStruct,this.minDateStruct)},t.prototype.checkReference=function(){if(this.referenceDate){var e=l.InterpolationService.interpolate(this.referenceDate,{year:this.date.getFullYear(),month:this.date.getMonth()+1,date:this.date.getDate()}).split("-").map((function(e){return+e})),t=new Date(Date.UTC(e[0],e[1]-1,e[2]));console.log("currentRef",t),console.log("currentDate",this.date);var n=864e5*this.stepDays,o=(this.date.getTime()-t.getTime())/n;this.date=new Date(t.getTime()+Math.round(o)*n),this.dateStruct=this.timeUtils.convertDate(this.date)}},t.ctorParameters=function(){return[{type:l.TimeUtilsService}]},o([e.Input(),a("design:type",Date)],t.prototype,"date",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"dateChange",void 0),o([e.Input(),a("design:type",String)],t.prototype,"timestep",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"minDate",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"maxDate",void 0),o([e.Input(),a("design:type",String)],t.prototype,"style",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"stepDays",void 0),o([e.Input(),a("design:type",String)],t.prototype,"referenceDate",void 0),t=o([e.Component({selector:"date-selection",template:'<div class="date-control container-fluid">\n  <div *ngIf="style!==\'arrows\'" class="row no-gutters">\n    <div class="col-8 form-group-inline">\n        <div class="input-group input-group-sm">\n          <input class="form-control form-control-sm" placeholder="yyyy-mm-dd"\n                 name="dp" [(ngModel)]="dateStruct" (ngModelChange)="dateStructChanged()"\n                 ngbDatepicker #d="ngbDatepicker"\n                 [maxDate]="maxDateStruct" [minDate]="minDateStruct">\n          <div class="input-group-addon" (click)="d.toggle()" >\n            <i class="fa fa-calendar"></i>\n          </div>\n        </div>\n      </div>\n\n    \x3c!--\n      <div class="col-2" >\n        <button class="btn btn-secondary btn-sm" [disabled]="atMax"\n                (click)="move(1)"><i class="fa fa-chevron-right"></i></button>\n      </div>\n    --\x3e\n  </div>\n\n  <div *ngIf="style===\'arrows\'">\n    <date-element *ngIf="need.day"   [src]="dateStruct" [property]="\'day\'" [label]="\'Day\'"\n                  [step]="stepDays"\n                  (changed)="dateStructChanged()"></date-element>\n    <date-element *ngIf="need.month" [src]="dateStruct" [property]="\'month\'" [label]="\'Month\'"\n                  (changed)="dateStructChanged()"></date-element>\n    <date-element *ngIf="need.year"  [src]="dateStruct" [property]="\'year\'" [label]="\'Year\'"\n                  (changed)="dateStructChanged()"></date-element>\n  </div>\n</div>\n'}),a("design:paramtypes",[l.TimeUtilsService])],t)}();n.DateSelectionComponent=i}))),B=(y(N),N.DateSelectionComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t){this.pointSelectionService=t,this.getKeys=Object.keys,this.propertyChanged=new e.EventEmitter,this.tooltipPlacement="right",this.availableTags=null,this.tags={},this.pointVariables=[]}return Object.defineProperty(t.prototype,"publication",{get:function(){return this.layer&&this.layer.layer&&this.layer.layer.publications?this.layer.layer.publications[this.layer.options.publication||0]:null},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var e=this;this.map&&(this.selectedFeatureSubscription=this.map.featureSelected.subscribe((function(t){return e.featureSelected(t)}))),this.layer&&setTimeout((function(){e.findTags()}))},t.prototype.ngOnDestroy=function(){this.selectedFeatureSubscription&&this.selectedFeatureSubscription.unsubscribe()},t.prototype.featureSelected=function(e){this.publication&&this.publication.pointdata&&(this.selectedFeature=e.feature,this.queryPointData())},t.prototype.publicationSelected=function(e){this.layer.options.publication=e,this.publication.pointdata&&(this.pointSelectionChanged(),this.updateVariables()),this.update(e)},t.prototype.updateLayer=function(){this.layer.options.tags=this.tags,this.layer.update(),this.propertyChanged.emit(this.layer)},t.prototype.update=function(e){var t=this;this.updateLayer(),setTimeout((function(){t.findTags()}))},t.prototype.processTags=function(e){if(!e)return null;var t={};return Object.keys(e).forEach((function(n){var o=e[n];t[n]=o.map((function(e){var t=e;if(t.value&&t.label)return t;return{value:e,label:e}}))})),t},t.prototype.findTags=function(){this.publication.pointdata?this.availableTags=this.processTags(this.publication.pointdata.tags):this.availableTags=this.processTags(this.layer.flattenedSettings.options.tags),this.setDefaultTags()},t.prototype.tagChanged=function(e){this.queryPointData(),this.update(null)},t.prototype.setDefaultTags=function(){var e=this;this.availableTags&&(Object.keys(this.availableTags).forEach((function(t){void 0===e.tags[t]&&(e.tags[t]=e.availableTags[t][0].value)})),this.updateLayer())},t.prototype.zoomToExtent=function(){this.map?(this.map.lat=this.layer.layer.lat,this.map.lng=this.layer.layer.lon,this.map.zoom=this.layer.layer.zoom||13):console.log("NO MAP!")},t.prototype.pointSelection=function(){return{catalog:this.publication.pointdata,variable:this.selectedVariable,feature:this.selectedFeature,tags:this.tags}},t.prototype.queryPointData=function(){this.publication&&this.publication.pointdata;this.publication&&this.publication.pointdata&&(this.pointSelectionChanged(),this.updateVariables())},t.prototype.updateVariables=function(){var e=this,t=this.pointSelection();this.pointSelectionService.timeseriesVariables(t).subscribe((function(t){e.pointVariables=t.slice(),e.publication.pointdata.exclude&&(e.pointVariables=e.pointVariables.filter((function(t){return!e.publication.pointdata.exclude.some((function(e){return!!t.value.match(e)}))}))),e.pointVariables.length?e.pointVariables.findIndex((function(t){return t.value===e.selectedVariable}))<0&&(e.pointVariables.findIndex((function(t){return t.value===e.publication.pointdata.defaultVariable}))>=0?e.selectedVariable=e.publication.pointdata.defaultVariable:e.selectedVariable=e.pointVariables[0].value):e.selectedVariable=null,e.pointSelectionChanged()}))},t.prototype.pointSelectionChanged=function(){this.pointSelectionService.pointSelection(this.pointSelection())},t.ctorParameters=function(){return[{type:l.PointSelectionService}]},o([e.Input(),a("design:type",l.MappedLayer)],t.prototype,"layer",void 0),o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"propertyChanged",void 0),o([e.Input(),a("design:type",String)],t.prototype,"tooltipPlacement",void 0),t=o([e.Component({selector:"layer-properties",template:'<div class="container-fluid">\n  <p><strong>{{layer?.title}}</strong>\n    <span *ngIf="layer.description()"\n    [ngbTooltip]="layer.description()"\n    [placement]="tooltipPlacement"\n    class="layer-info-target"\n    container="body">\n  &nbsp;<i class="fa fa-info-circle"></i>\n  </span>\n  &nbsp;<span *ngIf="layer.interpolatedDownloadURL">\n    <small><a target="_blank"\n              [href]="layer.interpolatedDownloadURL"\n              [ngbTooltip]="\'Download data\'"\n              container="body">\n      <i class="fa fa-download"></i>\n    </a></small>\n  </span>\n  </p>\n\n  <div *ngIf="layer?.layer.publications.length>1">\n    <span *ngIf="layer.layer.publications[0].timestep">Timestep </span>\n    <span *ngIf="!layer.layer.publications[0].timestep">{{ layer.layer.options.publicationLabel || \'Variable\' }} </span>\n    <select [(ngModel)]="layer.options.publication" (ngModelChange)="publicationSelected($event)">\n      <option *ngFor="let p of layer.layer.publications; let i=index" [ngValue]="i">{{p.label || p.timestep}}</option>\n    </select>\n  </div>\n  <div *ngIf="layer?.layer.publications.length===1">\n    {{publication?.label}}\n  </div>\n\n  <div *ngIf="publication&&publication.timestep">\n    <hr/>\n    <date-selection [(date)]="layer.options.date"\n      (dateChange)="update($event)"\n      [timestep]="publication.timestep"\n      [stepDays]="publication.timestepMultiplier||1"\n      [referenceDate]="publication.timestepReference"\n      [minDate]="publication.options.start"\n      [maxDate]="publication.options.end"></date-selection>\n  </div>\n\n  <div *ngIf="layer.layer.options.smallExtent">\n    <hr/>\n    <button class="btn btn-sm btn-primary" (click)="zoomToExtent()">Zoom to Extent</button>\n  </div>\n\n\x3c!--\n  <div *ngIf="layer.layer.options.vectors">\n    <p>Lets filter those {{layer.layer.options.vectors}}s, eh?</p>\n  </div>\n--\x3e\n\n  <div *ngIf="availableTags">\n    <div *ngFor="let tag of getKeys(availableTags)">\n      {{tag}}\n      <select [(ngModel)]="tags[tag]" (ngModelChange)="tagChanged(tag)">\n        <option *ngFor="let val of availableTags[tag]" [ngValue]="val.value">{{val.label}}</option>\n      </select>\n    </div>\n  </div>\n\n  <div *ngIf="publication?.pointdata">\n    Variable:\n    <select [(ngModel)]="selectedVariable" (ngModelChange)="queryPointData()">\n      <option *ngFor="let v of pointVariables" [ngValue]="v.value">{{v.label}}</option>\n    </select>\n  </div>\n  \x3c!--\n  <div *ngIf="publication">\n    <p>Start: {{publication.options.start}}</p>\n    <p>End: {{publication.options.end}}</p>\n    <p>{{publication|json}}</p>\n  </div>\n  <button (click)="update()">Force update...</button>\n  --\x3e\n</div>'}),a("design:paramtypes",[l.PointSelectionService])],t)}();n.LayerPropertiesComponent=i}))),z=(y(B),B.LayerPropertiesComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t){this.metadata=t,this.allowRemove=!0,this.showLegends=!0,this.allowReorder=!0,this.layersChange=new e.EventEmitter,this.foo="bar"}return t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(e){e.layers&&this.layers&&(this.applyViewMode(),this.fetchMetadata())},t.prototype.applyViewMode=function(){var e=this;void 0!==this.uniformViewMode&&this.layers.forEach((function(t){return t.options.legend=e.uniformViewMode}))},t.prototype.allLegends=function(e){this.uniformViewMode=e,this.layers.forEach((function(t){return t.options.legend=e}))},t.prototype.layerLegend=function(e,t){this.uniformViewMode=void 0,e.options.legend=t},t.prototype.moveToTop=function(e){this.layers=[this.layers[e]].concat(this.layers.slice(0,e)).concat(this.layers.slice(e+1)),this._changed()},t.prototype.moveUp=function(e){if(0!==e){var t=this.layers;this.layers=t.slice(0,e-1).concat([t[e],t[e-1]]).concat(t.slice(e+1)),this._changed()}},t.prototype.moveDown=function(e){if(e!==this.layers.length-1){var t=this.layers;this.layers=t.slice(0,e).concat([t[e+1],t[e]]).concat(t.slice(e+2)),this._changed()}},t.prototype.moveToBottom=function(e){this.layers=this.layers.slice(0,e).concat(this.layers.slice(e+1)).concat([this.layers[e]]),this._changed()},t.prototype.removeLayer=function(e){var t=this.layers.slice();t.splice(e,1),this.layers=t,this._changed()},t.prototype.layerPropertyChanged=function(e){this.layers=this.layers.slice(),this._changed()},t.prototype._changed=function(){this.fetchMetadata(),this.layersChange.emit(this.layers)},t.prototype.fetchMetadata=function(){var e=this;this.layers.forEach((function(t){e.metadata.populateMetadata(t)}))},t.ctorParameters=function(){return[{type:l.MetadataService}]},o([e.Input(),a("design:type",Array)],t.prototype,"layers",void 0),o([e.Input(),a("design:type",w.LayeredMapComponent)],t.prototype,"map",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"allowRemove",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"showLegends",void 0),o([e.Input(),a("design:type",Object)],t.prototype,"allowReorder",void 0),o([e.Output(),a("design:type",Object)],t.prototype,"layersChange",void 0),t=o([e.Component({selector:"layer-control",template:'<div class="layers-control">\n  <div *ngIf="showLegends" class="layers-control-header"> \x3c!-- header --\x3e\n    <div class="float-right">\n      \x3c!-- TODO Attach handlers and tooltips to each icon --\x3e\n      <i class="fa fa-lg fa-cog discrete-icon" (click)="allLegends(false)"></i>\n      <i class="fa fa-lg fa-th-list discrete-icon" (click)="allLegends(true)"></i>\n    </div>\n    <br/>\n  </div>\n\n  <div *ngIf="layers">\n    <div *ngFor="let l of layers; let i = index"\n         class="layer-control d-flex justify-content-between">\n      <div class="p-2" style="width:100%">\n        <div *ngIf="showLegends&&l.options.legend">\n          <div *ngIf="l.flattenedSettings?.palette || l.legendURL">\n            <map-legend [title]="l.title"\n              [imageURL]="l.legendURL"\n              [helpText]="l.description()"\n              [mapUnits]="l.flattenedSettings?.units"\n              [cbPalette]="l.flattenedSettings?.palette?.name||l.flattenedSettings?.palette"\n              [cbCount]="l.flattenedSettings?.numcolorbands||l.flattenedSettings?.palette?.count"\n              [cbReverse]="l.flattenedSettings?.palette?.reverse"\n              [cbRange]="l.flattenedSettings?.colorscalerange">\n            </map-legend>\n          </div>\n        </div>\n\n        <div *ngIf="!showLegends||!l.options.legend">\n          <layer-properties [layer]="l"\n                            [map]="map"\n                            (propertyChanged)="layerPropertyChanged($event)">\n          </layer-properties>\n        </div>\n      </div>\n      <div class="p-2">\n          <div>\n            \x3c!-- TODO Attach handlers and tooltips to each icon --\x3e\n            <i *ngIf="allowReorder" class="fa fa-bars discrete-icon"></i><br *ngIf="allowReorder"/>\n            <i *ngIf="showLegends" class="fa fa-cog discrete-icon"\n               ngbTooltip="Show layer controls" placement="right" data-container="body"\n               (click)="layerLegend(l,false)"></i><br *ngIf="showLegends"/>\n            <i *ngIf="showLegends" class="fa fa-th-list discrete-icon"\n               ngbTooltip="Show layer data" placement="right" data-container="body"\n               (click)="layerLegend(l,true)"></i><br *ngIf="showLegends"/>\n            <i *ngIf="allowReorder" class="fa fa-angle-double-up discrete-icon"\n               ngbTooltip="Move to top" placement="right" data-container="body"\n              (click)="moveToTop(i)"></i><br *ngIf="allowReorder"/>\n            <i *ngIf="allowReorder" class="fa fa-angle-up discrete-icon"\n               ngbTooltip="Move up" placement="right" data-container="body"\n              (click)="moveUp(i)"></i><br *ngIf="allowReorder"/>\n            <i *ngIf="allowReorder" class="fa fa-angle-down discrete-icon"\n               ngbTooltip="Move down" placement="right" data-container="body"\n              (click)="moveDown(i)"></i><br *ngIf="allowReorder"/>\n            <i *ngIf="allowReorder" class="fa fa-angle-double-down discrete-icon"\n               ngbTooltip="Move to bottom" placement="right" data-container="body"\n              (click)="moveToBottom(i)"></i><br *ngIf="allowReorder"/>\n            <i *ngIf="allowRemove" class="fa fa-times discrete-icon"\n               ngbTooltip="Remove layer" placement="right" data-container="body"\n              data-toggle="tooltip" title="Remove layer"\n              (click)="removeLayer(i)"></i>\n          </div>\n        </div>\n      </div>\n  </div>\n</div>\n\n\x3c!-- Should this control be outside the map? eg to the left? --\x3e\n',styles:[".layers-control{\n  width:200px;\n}\n\n\n.layers-control-header, .layer-control{\n  border-bottom: 1.5px solid #aaa;\n}"]}),a("design:paramtypes",[l.MetadataService])],t)}();n.LayerControlComponent=i}))),U=(y(z),z.LayerControlComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.layerSelected=new e.EventEmitter}return t.prototype.ngAfterViewInit=function(){},t.prototype.layerClick=function(e,t,n){this.stop(e);var o={layer:t,action:n};this.layerSelected.emit(o)},t.prototype.stop=function(e){e.preventDefault(),e.stopPropagation()},o([e.Input(),a("design:type",l.Catalog)],t.prototype,"catalog",void 0),o([e.Input(),a("design:type",Boolean)],t.prototype,"includeSearch",void 0),o([e.Output(),a("design:type",e.EventEmitter)],t.prototype,"layerSelected",void 0),t=o([e.Component({selector:"theme-navbar",template:'<ul class="navbar-nav">\n  <li class="nav-item" ngbDropdown *ngFor="let theme of catalog?.themes">\n    <a class="nav-link" ngbDropdownToggle href="#"><i class="fa" [ngClass]="theme.icon"></i></a>\n    <div ngbDropdownMenu class="dropdown-menu">\n      <a class="dropdown-item" href="#" (click)="layerClick($event,layer,\'replace\')" *ngFor="let layer of theme.layers">\n        <div>\n          <span>{{layer.name}}</span>\n          <span class="float-right layer-select-icons">\n            <i class="fa fa-map layer-select-icon discrete-icon"\n               (click)="layerClick($event,layer,\'replace\')"\n               placement="right"\n               ngbTooltip="Map this layer. (Replace any existing layers)"></i>\n            <br/>\n            <i class="fa fa-plus layer-select-icon discrete-icon"\n               (click)="layerClick($event,layer,\'add\')"\n               placement="right"\n               ngbTooltip="Add this layer to the map."></i>\n          </span>\n        </div>\n      </a>\n    </div>\n  </li>\n</ul>\n\n\x3c!--\n\n[ng-reflect-ngb-tooltip].yellow + .tooltip {\n    background-color: yellow;\n}\n--\x3e',styles:["\n.layer-select-icons{\n  font-size:0.75em;\n  margin-right:-20px;\n}\n\n/* Annoying... using /deep/ to access the child component\n * but /deep/ (and synonyms) are deprecated. Not clear what\n * we should be doing\n */\n/deep/ .tooltip-inner {\n  width: 400px;\n}\n\n.dropdown-item{\n  border-bottom: 1px solid #aaa;\n  height: 40px;\n}\n"]}),a("design:paramtypes",[])],t)}();n.ThemeNavbarComponent=i}))),Z=(y(U),U.ThemeNavbarComponent,h((function(t,n){var o=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r},a=f&&f.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(e){this._api=e}return t.prototype.geocode=function(e,t){var n=this,o=new Promise((function(t,o){n._api.load().then((function(){(new google.maps.Geocoder).geocode({address:e,componentRestrictions:{country:"AU"},region:"AU"},(function(e,n){n!==google.maps.GeocoderStatus.OK?o():t(e.filter((function(e){return"Australia"!==e.formatted_address})))}))}))}));return u.from(o)},t.ctorParameters=function(){return[{type:i.MapsAPILoader}]},t=o([e.Injectable(),a("design:paramtypes",[i.MapsAPILoader])],t)}();n.GeocodingService=r}))),q=(y(Z),Z.GeocodingService,h((function(s,p){var c=f&&f.__decorate||function(e,t,n,o){var a,i=arguments.length,r=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(a=e[l])&&(r=(i<3?a(r):i>3?a(t,n,r):a(t,n))||r);return i>3&&r&&Object.defineProperty(t,n,r),r};function d(e){for(var t in e)p.hasOwnProperty(t)||(p[t]=e[t])}Object.defineProperty(p,"__esModule",{value:!0}),d(g),d(m),d(v),d(C),d(O),d(_),d(I),d(R),d(j),d(S),d(T),d(P),d(M),d(x),d(L),d(k),d(D),d(V),d(E),d(A),d(F),d(N),d(B),d(z),d(w),d(U),d(b),d(Z);var u=[v.DateShifterComponent,C.OneTimeSplashComponent,O.DateElementComponent,_.ShareViewComponent,I.LocationSearchComponent,R.ZoomLayerComponent,j.ZoomFullComponent,S.ZoomOutComponent,T.ZoomInComponent,P.CycleBaseMapComponent,M.CycleOpacityComponent,x.ButtonBarComponent,L.TimeseriesChartComponent,k.FeatureTableComponent,D.CollapsibleMapControlComponent,V.BaseMapSelectionComponent,E.SimpleTreeNodeComponent,A.SimpleTreeComponent,F.CatalogComponent,N.DateSelectionComponent,B.LayerPropertiesComponent,z.LayerControlComponent,w.LayeredMapComponent,U.ThemeNavbarComponent,g.WMSLayerComponent,m.MapLegendComponent,b.MapControlComponent],y=[Z.GeocodingService],h=function(){function s(){}var p;return p=s,s.forRoot=function(e){return{ngModule:p,providers:y}},s=p=c([e.NgModule({imports:[r.CommonModule,t.FormsModule,i.AgmCoreModule,o.HttpClientModule,a.NgPipesModule,n.NgbModule,l.MapWaldCoreModule],declarations:u,exports:u,providers:y})],s)}();p.MapWaldBootstrapModule=h})));y(q),q.MapWaldBootstrapModule;return y(h((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(q)})))}));
//# sourceMappingURL=map-wald-visual.umd.min.js.map